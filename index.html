<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PodClone</title>
<style>
:root {
  --bg: #121212;
  --card: #1e1e1e;
  --accent: #03dac5;
  --text: #fff;
  --text-secondary: #ccc;
  --radius: 14px;
  --shadow: 0 4px 20px rgba(0,0,0,0.3);
  --error-bg: #2a2a2a;
  --error-text: #ff5555;
}
* { box-sizing: border-box; font-family: 'Roboto', sans-serif; }
body { margin: 0; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
header { display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--card); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 10; }
header h1 { font-weight: 500; font-size: 1.4rem; margin: 0; }
nav { display: flex; gap: 1rem; }
nav button { background: none; border: none; color: var(--accent); font-weight: 500; cursor: pointer; }
.content { flex: 1; overflow-y: auto; padding: 1rem; }
.feed-input { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
.feed-input input { flex: 1; padding: 0.7rem 1rem; border: none; border-radius: var(--radius); background: #2a2a2a; color: var(--text); }
.feed-input button { padding: 0.7rem 1rem; background: var(--accent); border: none; border-radius: var(--radius); color: #000; font-weight: 500; cursor: pointer; transition: 0.3s; }
.feed-input button:hover { opacity: 0.8; }
.episodes, .library { display: flex; flex-direction: column; gap: 1rem; }
.episode, .subscription { background: var(--card); border-radius: var(--radius); padding: 1rem; box-shadow: var(--shadow); display: flex; gap: 1rem; align-items: flex-start; transition: transform 0.2s; }
.episode:hover, .subscription:hover { transform: translateY(-2px); }
.episode img, .subscription img { width: 80px; height: 80px; border-radius: var(--radius); object-fit: cover; flex-shrink: 0; }
.episode-info, .subscription-info { flex: 1; }
.episode-title { font-size: 1rem; font-weight: 500; margin-bottom: 0.3rem; }
.episode-date { color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem; }
.episode button, .subscription button { background: var(--accent); color: #000; border: none; padding: 0.5rem 0.8rem; border-radius: var(--radius); font-size: 0.85rem; cursor: pointer; }
.error-card { background: var(--error-bg); color: var(--error-text); border-radius: var(--radius); padding: 1rem; display: flex; align-items: center; gap: 0.8rem; font-weight: 500; box-shadow: var(--shadow); }
footer.player { background: var(--card); padding: 0.8rem 1rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 -4px 10px rgba(0,0,0,0.5); position: sticky; bottom: 0; }
.player-info { display: flex; align-items: center; gap: 0.8rem; }
.player-info img { width: 50px; height: 50px; border-radius: var(--radius); object-fit: cover; }
.player-title { font-size: 0.9rem; font-weight: 500; }
.player-controls button { background: none; border: none; color: var(--accent); font-size: 1.3rem; cursor: pointer; }
</style>
</head>
<body>
  <header>
    <h1>PodClone</h1>
    <nav>
  <button id="exploreTab">üè† Explore</button>
  <button id="libraryTab">üìö Library</button>
</nav>

<div id="exploreContainer"></div>
<div id="libraryContainer" style="display:none;"></div>

  </header>
  <main class="content">
    <div id="exploreTab">
      <div class="feed-input">
        <input type="text" id="searchQuery" placeholder="Hƒæadaj podcast podƒæa n√°zvu...">
        <button id="searchBtn">Hƒæada≈•</button>
      </div>
      <div id="episodes" class="episodes"></div>
    </div>
    <div id="libraryTab" class="library" style="display:none"></div>
  </main>
  <footer class="player" id="playerBar" style="display:none">
    <div class="player-info">
      <img id="playerImg" src="" alt="cover">
      <div><div class="player-title" id="playerTitle"></div></div>
    </div>
    <div class="player-controls"><button id="playPause">‚è∏Ô∏è</button></div>
  </footer>
  <audio id="audio" preload="none"></audio>
  <script>
    const searchQuery = document.getElementById('searchQuery');
    const searchBtn = document.getElementById('searchBtn');
    const episodesContainer = document.getElementById('episodes');
    const playerBar = document.getElementById('playerBar');
    const playerImg = document.getElementById('playerImg');
    const playerTitle = document.getElementById('playerTitle');
    const playPauseBtn = document.getElementById('playPause');
    
const exploreTab = document.getElementById('exploreTab');
const libraryTab = document.getElementById('libraryTab');
const exploreContainer = document.getElementById('exploreContainer');
const libraryContainer = document.getElementById('libraryContainer');

exploreTab.addEventListener('click', () => {
  exploreContainer.style.display = 'block';
  libraryContainer.style.display = 'none';
});

libraryTab.addEventListener('click', () => {
  exploreContainer.style.display = 'none';
  libraryContainer.style.display = 'block';
  renderLibrary();
});

    // Listen Notes API kƒæ√∫ƒç
    const API_KEY = '6e09668dd40a4d2583288af26b371fee';

    // Funkcia na vyhƒæad√°vanie podcastov podƒæa n√°zvu
    async function searchPodcasts(query) {
  const url = `https://listen-api.listennotes.com/api/v2/search?q=${encodeURIComponent(query)}&type=podcast`;
  const res = await fetch(url, {
    headers: { 'X-ListenAPI-Key': API_KEY }
  });

  if (!res.ok) {
    throw new Error(`HTTP error! Status: ${res.status}`);
  }

  const data = await res.json();
  console.log('V√Ωsledky z API:', data);

  // Listen Notes vracia zoznam podcastov v data.results
  return data.results || [];
}

function addToLibrary(podcast) {
  // Naƒç√≠taj existuj√∫ce odbery z localStorage
  let subs = JSON.parse(localStorage.getItem('podclone_subscriptions')) || [];

  // Skontroluj, ƒçi u≈æ tento podcast nie je odobrat√Ω
  if (subs.some(p => p.feedUrl === podcast.feedUrl)) {
    alert('Tento podcast u≈æ m√°≈° v kni≈ænici.');
    return;
  }

  // Pridaj nov√Ω podcast do zoznamu
  subs.push(podcast);
  localStorage.setItem('podclone_subscriptions', JSON.stringify(subs));

  alert(`Podcast ‚Äû${podcast.title}‚Äú bol pridan√Ω do tvojej kni≈ænice.`);
}


function displayPodcasts(podcasts) {
  episodesContainer.innerHTML = '';

  if (!Array.isArray(podcasts) || podcasts.length === 0) {
    episodesContainer.innerHTML = '<div class="error-card">≈Ωiadne v√Ωsledky pre tento n√°zov podcastu.</div>';
    return;
  }

  podcasts.forEach(podcast => {
    const el = document.createElement('div');
    el.className = 'episode';
    el.innerHTML = `
      <img src="${podcast.image || podcast.thumbnail}" alt="">
      <div class="episode-info">
        <div class="episode-title">${podcast.title_original}</div>
        <button class="subscribeBtn">‚ûï Odobera≈•</button>
      </div>
    `;
    el.querySelector('.subscribeBtn').addEventListener('click', () => {
      addToLibrary({
        title: podcast.title_original,
        feedUrl: podcast.rss || '',
        imgUrl: podcast.image || podcast.thumbnail
      });
    });
    episodesContainer.appendChild(el);
  });
}
function renderLibrary() {
  const container = document.getElementById('libraryContainer');
  const subs = JSON.parse(localStorage.getItem('podclone_subscriptions')) || [];

  container.innerHTML = '';

  if (subs.length === 0) {
    container.innerHTML = '<div class="error-card">≈Ωiadne odbery zatiaƒæ.</div>';
    return;
  }

  subs.forEach(podcast => {
    const el = document.createElement('div');
    el.className = 'episode';
    el.innerHTML = `
      <img src="${podcast.imgUrl}" alt="">
      <div class="episode-info">
        <div class="episode-title">${podcast.title}</div>
        <button class="removeBtn">‚ùå Odstr√°ni≈•</button>
      </div>
    `;
    el.querySelector('.removeBtn').addEventListener('click', () => {
      removeFromLibrary(podcast.feedUrl);
      renderLibrary();
    });
    container.appendChild(el);
  });
}

function removeFromLibrary(feedUrl) {
  let subs = JSON.parse(localStorage.getItem('podclone_subscriptions')) || [];
  subs = subs.filter(p => p.feedUrl !== feedUrl);
  localStorage.setItem('podclone_subscriptions', JSON.stringify(subs));
}


    // Obsluha kliknutia na tlaƒçidlo "Hƒæada≈•"
    searchBtn.addEventListener('click', async () => {
      const query = searchQuery.value.trim();
      if (!query) return;
      const podcasts = await searchPodcasts(query);
      displayPodcasts(podcasts);
    });

    // Funkcia na prehr√°vanie epiz√≥dy
    function playEpisode(title, url, img) {
      const audio = document.getElementById('audio');
      audio.src = url;
      audio.play();
      playerBar.style.display = 'flex';
      playerTitle.textContent = title;
      playerImg.src = img;
      playPauseBtn.textContent = '‚è∏Ô∏è';
    }

    // Obsluha tlaƒçidla play/pause
    playPauseBtn.addEventListener('click', () => {
      const audio = document.getElementById('audio');
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = '‚è∏Ô∏è';
      } else {
        audio.pause();
        playPauseBtn.textContent = '‚ñ∂Ô∏è';
      }
    });
    async function openPodcastDetail(podcast) {
  exploreContainer.style.display = 'none';
  libraryContainer.style.display = 'none';

  const detailContainer = document.getElementById('detailContainer') || document.createElement('div');
  detailContainer.id = 'detailContainer';
  document.body.appendChild(detailContainer);
  detailContainer.innerHTML = `<h2>${podcast.title}</h2><p>Naƒç√≠tavam epiz√≥dy...</p>`;

  try {
    const res = await fetch(podcast.feedUrl);
    const text = await res.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text, 'text/xml');
    const items = xml.querySelectorAll('item');
    let html = '';

    items.forEach(item => {
      const title = item.querySelector('title')?.textContent || 'Bez n√°zvu';
      const audio = item.querySelector('enclosure')?.getAttribute('url');
      html += `
        <div class="episode">
          <div class="episode-title">${title}</div>
          <button onclick="playEpisode('${title}', '${audio}', '${podcast.imgUrl}')">‚ñ∂Ô∏è Prehra≈•</button>
        </div>`;
    });

    detailContainer.innerHTML = `
      <button onclick="backToLibrary()">‚¨ÖÔ∏è Sp√§≈•</button>
      <h2>${podcast.title}</h2>
      <img src="${podcast.imgUrl}" alt="">
      ${html}
    `;
  } catch (err) {
    detailContainer.innerHTML = `<div class="error-card">‚ö†Ô∏è Nepodarilo sa naƒç√≠ta≈• epiz√≥dy.</div>`;
  }
}

function backToLibrary() {
  document.getElementById('detailContainer').remove();
  libraryContainer.style.display = 'block';
}

  </script>
</body>